(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{2865:(e,t,n)=>{"use strict";n.d(t,{K:()=>r,TenantProvider:()=>s});var a=n(5155),o=n(2115);let l=(0,o.createContext)({subdomain:"",isTenant:!1,isMainDomain:!1,isAllowed:!0,checked:!1});function s(e){let{children:t}=e,[n,s]=(0,o.useState)(""),[r,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!0),[m,p]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{let e=window.location.hostname,t="office.roshandevkota.com.np",n="a.roshandevkota.com.np,b.roshandevkota.com.np".split(",")||[];if(e===t||n.includes(e)||"localhost"===e||"127.0.0.1"===e){if(console.log("hostname",e),console.log("main domain",t),console.log("tenanet subdomains",n),e===t||"localhost"===e||"127.0.0.1"===e)d(!0),i(!1),s("");else{let n=e.replace(".".concat(t),"").split(".")[0];i(!0),s(n),d(!1)}h(!0)}else h(!1);p(!0)},[]),m)?u?(0,a.jsx)(l.Provider,{value:{subdomain:n,isTenant:r,isMainDomain:c,isAllowed:u,checked:m},children:t}):(0,a.jsx)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"#f8d7da"},children:(0,a.jsxs)("div",{style:{padding:32,borderRadius:12,background:"#fff0f1",color:"#721c24",maxWidth:400,textAlign:"center",boxShadow:"0 4px 24px 0 #b71c1c10"},children:[(0,a.jsx)("h2",{style:{fontSize:"1.8rem",fontWeight:"bold",marginBottom:16},children:"\uD83D\uDEAB Not a registered tenant"}),(0,a.jsxs)("p",{children:["This domain (",(0,a.jsx)("b",{children:window.location.hostname}),") is not allowed to access this app."]}),(0,a.jsxs)("p",{style:{marginTop:20},children:["Please use the main site:\xa0",(0,a.jsx)("a",{href:"https://".concat("office.roshandevkota.com.np"),style:{color:"#0056b3",textDecoration:"underline"},children:"office.roshandevkota.com.np"})]})]})}):(0,a.jsx)("div",{children:"Loading..."})}function r(){return(0,o.useContext)(l)}},4871:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});let a=n(3464).A.create({baseURL:"https://back.roshandevkota.com.np",headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});a.interceptors.request.use(e=>{let t=function(){let e=window.location.hostname,t="office.roshandevkota.com.np";return e===t?"":("a.roshandevkota.com.np,b.roshandevkota.com.np".split(",")||[]).includes(e)?e.replace(".".concat(t),"").split(".")[0]:""}();t&&e.url&&!e.url.startsWith("/".concat(t,"/"))&&(e.url="/".concat(t).concat(e.url.startsWith("/")?"":"/").concat(e.url));{let t=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():null}("XSRF-TOKEN");console.log("XSRF-TOKEN from cookie:",t),t&&(console.log("Using XSRF-TOKEN from cookie:",t),e.headers["X-XSRF-TOKEN"]=decodeURIComponent(t))}return e});let o=a},5188:(e,t,n)=>{Promise.resolve().then(n.bind(n,8292))},5731:(e,t,n)=>{"use strict";n.d(t,{A:()=>c,AuthProvider:()=>i});var a=n(5155),o=n(2115),l=n(4871),s=n(5695);let r=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[n,i]=(0,o.useState)(null),[c,d]=(0,o.useState)(!0),u=(0,s.useRouter)(),h=(0,s.usePathname)();(0,o.useEffect)(()=>{if(h){if("/login"===h)return void d(!1);(async()=>{try{let e=await l.A.get("/me");i(e.data)}catch(e){i(null)}finally{d(!1)}})()}},[h]);let m=async(e,t)=>{d(!0);try{let n;await l.A.get("/sanctum/csrf-cookie"),await l.A.post("/login",{email:e,password:t});let a=await l.A.get("/me");i(a.data),u.replace("/")}catch(e){throw i(null),e}finally{d(!1)}},p=async()=>{try{await l.A.post("/logout")}catch(e){}localStorage.removeItem("token"),i(null),u.replace("/login")};return(0,a.jsx)(r.Provider,{value:{user:n,loading:c,login:m,logout:p},children:t})}function c(){let e=(0,o.useContext)(r);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},8292:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var a=n(5155),o=n(5731),l=n(2865),s=n(2115),r=n(5695),i=n(4871);function c(e){let{user:t}=e,[n,o]=(0,s.useState)(""),[l,r]=(0,s.useState)(!1),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),m=async e=>{var t,a,l;e.preventDefault(),r(!0),d(null),h(null);try{let e=await i.A.post("/tenant",{name:n});d("Tenant created: "+(null==(t=e.data)?void 0:t.name)),o("")}catch(e){h((null==e||null==(l=e.response)||null==(a=l.data)?void 0:a.message)||"Failed to create tenant.")}finally{r(!1)}};return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto my-16 p-8 rounded-2xl bg-white shadow-xl",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4 text-blue-800",children:"Admin Dashboard"}),(0,a.jsxs)("p",{className:"mb-8",children:["Welcome, ",t.name,"!"]}),(0,a.jsxs)("form",{onSubmit:m,className:"mb-4 flex gap-2",children:[(0,a.jsx)("input",{type:"text",className:"border px-4 py-2 rounded-lg flex-1",placeholder:"Tenant name",value:n,onChange:e=>o(e.target.value),required:!0,disabled:l}),(0,a.jsx)("button",{className:"px-6 py-2 bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-lg disabled:bg-blue-400 transition",type:"submit",disabled:l,children:l?"Creating...":"Create Tenant"})]}),c&&(0,a.jsx)("div",{className:"text-green-700",children:c}),u&&(0,a.jsx)("div",{className:"text-red-600",children:u})]})}function d(e){let{user:t}=e;return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto my-16 p-8 rounded-2xl bg-white shadow-xl",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4 text-green-700",children:"Tenant Dashboard"}),(0,a.jsxs)("p",{children:["Welcome, ",t.name,"!"]})]})}function u(){let{user:e,loading:t}=(0,o.A)(),{isMainDomain:n}=(0,l.K)(),i=(0,r.useRouter)();return((0,s.useEffect)(()=>{t||e||i.replace("/login")},[e,t,i]),t||!e)?(0,a.jsx)("div",{className:"p-10 text-center",children:"Loading..."}):n?(0,a.jsx)(c,{user:e}):(0,a.jsx)(d,{user:e})}}},e=>{var t=t=>e(e.s=t);e.O(0,[794,441,684,358],()=>t(5188)),_N_E=e.O()}]);